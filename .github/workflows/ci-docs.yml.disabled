name: Documentation Quality

on:
  push:
    branches: [ main, master ]
    paths:
      - '**.md'
      - '.markdownlint.yaml'
      - '.markdown-link-check.json'
      - '.github/workflows/ci-docs.yml'
  pull_request:
    branches: [ main, master ]
    paths:
      - '**.md'
      - '.markdownlint.yaml'
      - '.markdown-link-check.json'
      - '.github/workflows/ci-docs.yml'

jobs:
  markdown-lint:
    name: Markdown Linting
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Set up Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '18'
          cache: 'npm'

      - name: Install dependencies
        run: npm ci

      - name: Run markdownlint
        run: npx markdownlint-cli2 "**/*.md" "#node_modules" "#.venv" "#venv" "#htmlcov" "#.pytest_cache" "#.ruff_cache"

  markdown-link-check:
    name: Markdown Link Validation
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Set up Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '18'
          cache: 'npm'

      - name: Install dependencies
        run: npm ci

      - name: Check Markdown links
        run: |
          find . -name '*.md' \
            ! -path '*/node_modules/*' \
            ! -path '*/.venv/*' \
            ! -path '*/venv/*' \
            -exec npx markdown-link-check --config .markdown-link-check.json {} \;
        continue-on-error: true

  documentation-summary:
    name: Documentation Summary
    runs-on: ubuntu-latest
    needs: [markdown-lint, markdown-link-check]
    if: always()
    steps:
      - name: Summary
        run: |
          echo "## Documentation Quality Report" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "✅ Markdown linting: ${{ needs.markdown-lint.result }}" >> $GITHUB_STEP_SUMMARY
          echo "✅ Link validation: ${{ needs.markdown-link-check.result }}" >> $GITHUB_STEP_SUMMARY
