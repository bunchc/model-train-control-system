---
# Production Inventory for Model Train Control System
#
# SETUP INSTRUCTIONS:
# 1. Replace example IPs with your actual static IPs
# 2. Update ansible_user if different from defaults
# 3. Add/remove edge devices as needed
# 4. Ensure SSH keys are set up for passwordless authentication
#
# TRAIN ID & PLUGIN CONFIGURATION:
# - train_id: Auto-generated UUID on first deployment (leave commented initially)
#   Once generated, Ansible will update this file with the UUID
# - hardware_type: Controls which hardware plugin is loaded
#   * stepper_hat: Waveshare Stepper Motor HAT (app/stepper_hat.py)
#   * generic: Generic GPIO PWM controller (app/hardware.py)
#   * simulator: No-op simulator for testing without hardware (app/main.py)

all:
  children:
    # ========================================================================
    # Central Infrastructure (x86_64)
    # ========================================================================
    central:
      hosts:
        localhost:
          ansible_connection: local
          ansible_python_interpreter: /usr/bin/python3
          ansible_host: 192.168.1.199  # Mac's IP for edge controllers to reach
          ansible_user: "{{ lookup('env', 'USER') }}"

          # Component configuration
          deploy_central_api: true
          deploy_mqtt: true

          # Docker Compose settings
          compose_project_name: train-control
          compose_file: ../../docker/docker-compose.yml

      vars:
        # Central host is x86_64
        arch: amd64

        # Docker registry
        docker_registry: ghcr.io
        docker_registry_username: "{{ vault_github_username }}"
        docker_registry_password: "{{ vault_github_token }}"

        # MQTT Configuration
        mqtt_port: 1883
        mqtt_websocket_port: 9001
        mqtt_password: "{{ vault_mqtt_password }}"

        # Central API Configuration
        central_api_port: 8000
        central_api_db_path: /var/lib/train-control/central_api.db

    # ========================================================================
    # Edge Devices (Raspberry Pi / ARM64)
    # ========================================================================
    edge:
      hosts:
        rpi-train-01:
          ansible_host: 192.168.2.214
          ansible_user: pi
          ansible_port: 22

          # Edge controller configuration for multiple motors
          # Each motor gets its own container with unique train_id
          motors:
            - motor_port: 1  # M1 on the Waveshare HAT
              train_id: 9bf2f703-5ba2-5032-a749-01cce962bcf6  # Auto-generated
              train_name: "Express Line Engine"
              container_name: edge-controller-m1

            - motor_port: 3  # M3 on the Waveshare HAT
              train_id: 7cd3e891-4ab3-6143-b850-12ddf073ce87  # Auto-generated
              train_name: "Freight Line Engine"
              container_name: edge-controller-m3

          # Hardware type for all motors on this host
          hardware_type: dc_motor  # Options: dc_motor, stepper_hat, generic, simulator

      vars:
        # Edge devices are ARM64
        arch: arm64

        # Edge image build strategy
        # Set to 'true' to build image on RPi from source
        # Set to 'false' to pull pre-built image from GHCR
        build_edge_image: true
        build_edge_nocache: false

        # Docker registry (same as central)
        docker_registry: ghcr.io
        docker_registry_username: "{{ vault_github_username }}"
        docker_registry_password: "{{ vault_github_token }}"

        # Central API connection
        central_api_host: 192.168.1.199  # Mac's IP address
        central_api_port: 8000
        central_api_url: "http://{{ central_api_host }}:{{ central_api_port }}"

        # MQTT connection
        mqtt_broker: 192.168.1.199  # Mac's IP address
        mqtt_port: 1883
        mqtt_username: edge-controller
        mqtt_password: "{{ vault_mqtt_password }}"

        # Edge controller configuration
        edge_controller_image: "{{ docker_registry }}/bunchc/model-train-control-system/edge-controller"
        edge_controller_tag: latest
        log_level: INFO
        simulation_mode: false

  # ========================================================================
  # Global Variables (All Hosts)
  # ========================================================================
  vars:
    # Ansible connection settings
    ansible_python_interpreter: /usr/bin/python3

    # Docker settings
    docker_install_compose: true
    docker_users:
      - "{{ ansible_user }}"

    # GitHub Container Registry
    github_repo: bunchc/model-train-control-system

    # Timezone
    timezone: America/Los_Angeles
